<!DOCTYPE html>
<html lang="en">
  <head>
    <title>AzureAIVisionFace  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="AzureAIVisionFace  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          AzureAIVisionFace Docs
        </a>
         (100% documented)
      </p>
    
      <div class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </div>
    
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">AzureAIVisionFace Reference</a>
      <img class="carat" src="img/carat.png" alt=""/>
      AzureAIVisionFace  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/AnalyzedFace.html">AnalyzedFace</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/AnalyzingFace.html">AnalyzingFace</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FaceActionRequiredFromApplicationTask.html">FaceActionRequiredFromApplicationTask</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FaceAnalysisOptions.html">FaceAnalysisOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FaceAnalyzedDetails.html">FaceAnalyzedDetails</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FaceAnalyzedResult.html">FaceAnalyzedResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FaceAnalyzer.html">FaceAnalyzer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FaceAnalyzerCreateOptions.html">FaceAnalyzerCreateOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FaceAnalyzingResult.html">FaceAnalyzingResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FaceLivenessResult.html">FaceLivenessResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FaceRecognitionResult.html">FaceRecognitionResult</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/FaceActionRequiredFromApplication.html">FaceActionRequiredFromApplication</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/FaceAnalyzerMode.html">FaceAnalyzerMode</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/FaceAnalyzingFeedbackForFace.html">FaceAnalyzingFeedbackForFace</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/FaceAnalyzingWarning.html">FaceAnalyzingWarning</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/FaceLivenessFailureReason.html">FaceLivenessFailureReason</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/FaceLivenessStatus.html">FaceLivenessStatus</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/FaceNotRecognizedReason.html">FaceNotRecognizedReason</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/FaceRecognitionFailureReason.html">FaceRecognitionFailureReason</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/FaceRecognitionMode.html">FaceRecognitionMode</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/FaceRecognitionStatus.html">FaceRecognitionStatus</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/FaceSelectionMode.html">FaceSelectionMode</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/FaceSessionStoppedReason.html">FaceSessionStoppedReason</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/FaceTrackingState.html">FaceTrackingState</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Type%20Definitions.html">Type Definitions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:AZFaceAnalyzer.h@T@AZFaceAnalyzedEventHandler">FaceAnalyzedEventHandler</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:AZFaceAnalyzer.h@T@AZFaceAnalyzingEventHandler">FaceAnalyzingEventHandler</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:AZFaceAnalyzer.h@T@AZFaceSessionStartedEventHandler">FaceSessionStartedEventHandler</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:AZFaceAnalyzer.h@T@AZFaceSessionStoppedEventHandler">FaceSessionStoppedEventHandler</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/FaceAnalysisOptions.html">FaceAnalysisOptions</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content top-matter">
            
            <h1 id='get-started-with-the-azure-ai-vision-face-client-sdk-for-ios-preview' class='heading'>Get started with the Azure AI Vision Face Client SDK for iOS (Preview)</h1>

<p>In this sample, you will learn how to build and run the face liveness detection application. The Azure AI Vision Face Client SDK for iOS is currently in preview. The APIs are subject to change.</p>
<h3 id='api-reference-documentation' class='heading'>API Reference Documentation</h3>

<ul>
<li>Swift API reference documents: <a href="https://azure.github.io/azure-sdk-for-ios/">Azure SDK for iOS Docs</a>, <a href="https://azure.github.io/azure-sdk-for-ios/AzureAIVisionCore/index.html">AzureAIVisionCore</a>, <a href="https://azure.github.io/azure-sdk-for-ios/AzureAIVisionFace/index.html">AzureAIVisionFace</a></li>
</ul>
<h2 id='prerequisites' class='heading'>Prerequisites</h2>

<ol>
<li>An Azure Face API resource subscription.</li>
<li>A Mac (with iOS development environment including Xcode 13+) and an iPhone (with iOS version 14 or above) to test the AzureAIVision SDK.</li>
<li>An Apple developer account to install and run development apps on the iPhone.</li>
</ol>
<h2 id='set-up-the-environment' class='heading'>Set up the environment</h2>

<ol>
<li>If this is your first time using your Mac to develop, you should build a sample app from <a href="https://developer.apple.com/tutorials/sample-apps/aboutme">About Me &#x2014; Sample Apps Tutorials | Apple Developer Documentation</a> and run it on your phone before you attempt to build the App here. This will help ensure that your developer environment has been setup properly.</li>
<li>If you have a valid Azure subscription that has been provisioned for Face API Liveness Detection, you can get the access token to access the release artifacts. More details can be found in <a href="../../../../GET_FACE_ARTIFACTS_ACCESS.md">GET_FACE_ARTIFACTS_ACCESS</a>.</li>
<li>To install the SDK packages for your iOS development Application in Xcode, here are ways through CocoaPods or Swift Package Manager:</li>
</ol>

<ul>
<li><p>CocoaPods (<a href="https://guides.cocoapods.org/using/getting-started.html">CocoaPods Guides - Getting Started</a>)</p>

<ul>
<li><p>Add the following lines to your project&rsquo;s Podfile. <code>&#39;YourBuildTargetNameHere&#39;</code> is an example target, and you should use your actual target project instead.</p>
<pre class="highlight ruby"><code> <span class="c1"># add repos as source</span>
 <span class="n">source</span> <span class="s1">'https://msface.visualstudio.com/SDK/_git/AzureAIVisionCore.podspec'</span>
 <span class="n">source</span> <span class="s1">'https://msface.visualstudio.com/SDK/_git/AzureAIVisionFace.podspec'</span>

 <span class="n">target</span> <span class="s1">'YourBuildTargetNameHere'</span> <span class="k">do</span>
    <span class="c1"># add the pods here, optionally with version specification as needed</span>
    <span class="n">pod</span> <span class="s1">'AzureAIVisionCore'</span>
    <span class="n">pod</span> <span class="s1">'AzureAIVisionFace'</span>
 <span class="k">end</span>
</code></pre></li>
<li><p>For access authorization to the repos, the steps depend on your system Git and your security preferences.</p>

<ul>
<li>If you are using Git credential manager, you will be prompted for username and password. Make a random username and use the accessToken from previous step to be the password. Random username means a random string because it is not really taken in this case.</li>
<li><p>To use <a href="https://git-scm.com/docs/git-config/2.22.0#Documentation/git-config.txt-httpextraHeader"><code>http.extraHeader</code> approach of <code>git-config</code></a>, you need to convert the token to base64 format. Refer to <a href="https://learn.microsoft.com/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate?view=azure-devops&tabs=Linux#use-a-pat">the <strong>Use a PAT</strong> section of this Azure DevOps documentation article</a>. Note that instead of using the git clone invocation as shown in the example, you should call:</p>
<pre class="highlight plaintext"><code>git config --global http.https://msface.visualstudio.com/SDK.extraHeader="Authorization: Basic ${B64_PAT}"
</code></pre></li>
<li><p>For other types of Git installation, refer to <a href="https://git-scm.com/docs/gitfaq#_credentials">the <strong>Credentials</strong> section of Git FAQ</a>.</p></li>
</ul></li>
</ul></li>
<li><p>Swift Package Manager (<a href="https://www.swift.org/documentation/package-manager/">Swift.org - Package Manager</a>)</p>

<ul>
<li><p>Use the following repository URLs in Swift Package Manager, one at a time:</p>
<pre class="highlight plaintext"><code> https://msface.visualstudio.com/SDK/_git/AzureAIVisionCore.xcframework
</code></pre>
<pre class="highlight plaintext"><code> https://msface.visualstudio.com/SDK/_git/AzureAIVisionFace.xcframework
</code></pre></li>
<li><p>You will see a pop-up window asking for username and password. Make a random username and use the accessToken from previous step to be the password. Random username means a random string because it is not really taken in this case.</p></li>
<li><p>You may encounter error if your Xcode has never been configured to use Git LFS.
If Git LFS is never installed on your machine, refer to <a href="https://git-lfs.github.com/">Git LFS official site</a> for instructions on how to install. To make Xcode recognize the <code>git-lfs</code> command, create symbolic link like so:</p>
<pre class="highlight shell"><code> sudo ln -s <span class="k">$(</span>which git-lfs<span class="k">)</span> <span class="k">$(</span>xcode-select -p<span class="k">)</span>/usr/bin/git-lfs
</code></pre></li>
<li><p>If the previous step failed with <code>ln: git-lfs: Operation not permitted</code>, your macOS version has <a href="https://developer.apple.com/documentation/security/disabling_and_enabling_system_integrity_protection">System Integrity Protection (SIP)</a> enabled and configured to protect the Git executable shipped with Xcode toolchain. Use your security judgment or consult with your enterprise administrators, then temporarily disable SIP before reattempting to run the code above if this is acceptable for you, following instructions in the official article <a href="https://developer.apple.com/documentation/security/disabling_and_enabling_system_integrity_protection">Disabling and Enabling System Integrity Protection | Apple Developer Documentation</a>. Alternatively, you may prefer to use CocoaPods instead. This issue has been <a href="https://github.com/apple/swift-package-manager/issues/5351">reported to Apple</a> and we are awaiting resolution.</p></li>
</ul></li>
</ul>

<ol>
<li><a href="#api-reference-documentation">Refer to the API reference documentation</a> to learn more about our SDK APIs.</li>
</ol>
<h2 id='next-steps' class='heading'>Next steps</h2>

<p>Now that you have setup your environment you can either:</p>

<ul>
<li><a href="#build-and-run-sample-app">Build and run sample app</a></li>
<li><a href="#integrate-face-analysis-into-your-own-application">Integrate face analysis into your own application</a></li>
</ul>
<h2 id='build-and-run-sample-app' class='heading'>Build and run sample App</h2>

<ol>
<li>Download the sample App folder. Double click the .xcodeproj file. This will open the project in Xcode.</li>
<li>Add package dependency through Swift Package Manager, as mentioned before. You should add both AzureAIVisionFace.xcframework and AzureAIVisionCore.xcframework into the project.</li>
<li>Set the App bundle identifier and developer team in XCode per your needs.</li>
<li>Now attach your phone to the Mac. You should get prompt on the phone asking you to &ldquo;Trust&rdquo; the Mac. Enable the trust.</li>
<li>The phone should now show up in the Xcode top bar. Your iPhone name should be visible.</li>
<li>Now build and run the app.</li>
</ol>
<h3 id='run-the-sample' class='heading'>Run the sample</h3>

<p>The first time the app runs, It is going to ask for camera permission. Allow the camera access. The App starts with the launch page. Some of the buttons are disabled until you configure the settings. Click the settings page. The settings page has the following fields/settings from top to bottom. Enter them correctly.</p>

<p><strong>API endpoint</strong>
This is the Azure subscription endpoint, where the application makes the FaceAPI calls to.</p>

<p><strong>Subscription</strong>
This secret key to access the Azure endpoint.</p>
<h3 id='test-out-the-key-scenarios' class='heading'>Test out the key scenarios</h3>

<p>The application supports 2 scenarios.</p>
<h4 id='liveness' class='heading'>Liveness</h4>

<p>This mode checks to see if the person in camera view is a live person or not.</p>

<ol>
<li>Click on the &ldquo;Liveness&rdquo; button, following the guidance on the screen.</li>
<li>Click &ldquo;Start&rdquo; and show your face to the front-facing camera. As it processes your images, the screen will display user feedback on image quality. The screen will also flash black and white. This is needed for liveness analysis.</li>
<li>The result is displayed as Liveness status (Real/Spoof).</li>
<li>You can return to the main page by clicking &ldquo;Continue&rdquo;.</li>
</ol>
<h4 id='livenesswithverify' class='heading'>LivenessWithVerify</h4>

<p>This mode checks the person liveness with verification against a provided face image.</p>

<ol>
<li>Click on the &ldquo;LivenessWithVerify&rdquo; button and it will prompt you to select an image of a face to verify against.</li>
<li>Click next and show your face to the front-facing camera. As it processes your images, the screen will display user feedback on image quality. The screen will also flash black and white. This is needed for liveness analysis.</li>
<li>The result is displayed as Liveness status (Real/Spoof), verification status (Recognized/NotRecognized), and verification confidence score.</li>
<li>You can return to the main page by clicking &ldquo;Continue&rdquo;.</li>
</ol>
<h2 id='integrate-face-analysis-into-your-own-application' class='heading'>Integrate face analysis into your own application</h2>

<p>Based on the provided sample App, here is the instructions on how to integrate face analysis function into your own App. First, face analysis using AzureAIVision SDK requires a Vision source and a Vision service to be configured. The Vision source for the mobile scenario defaults to built in camera on the mobile device. The Vision source is wrapped into a SwiftUI View object that is required for a preview (please refer to sample App file &ldquo;CameraPreviewView.swift&rdquo;). The Vision service requires Azure subscription. The Azure subscription prerequisites are also common to all scenarios.
In the sample App, we provide sample views like: MainView.swift, LaunchView.swift, ResultView.swift, SettingsView.swift to help with the App flow. These files are not needed in your Application, and please take them for your reference only. More importantly, we provide the following example code to interact with the camera and the AzureAIVision SDK, which you should adapt into your own App properly. For your convenience, we put all those required files under the &ldquo;FaceAnalyerSample/Core&rdquo; folder.</p>

<p>Here are the recommended steps you should consider to follow during your integration. Also, here is an companion video that shows <strong><a href="https://aka.ms/azure-ai-vision-face-liveness-client-sdk-ios-integration-video">how to do the integration in an empty Xcode project</a></strong>.</p>

<p><a href="https://aka.ms/azure-ai-vision-face-liveness-client-sdk-ios-integration-video"><img src="../../../../docs/face/iOS-integration-video-front.jpg" alt="iOS integration video front"></a></p>
<h3 id='1-configure-your-xcode-project' class='heading'>1. Configure your Xcode project</h3>

<p>(1) in the &ldquo;Xcode -&gt; Targets -&gt; Build Settings -&gt; Swift Compiler - Language&rdquo;, select the &ldquo;C++ and Objective-C Interoperability&rdquo; to be &ldquo;C++ / Objective-C++</p>

<p>(2) in the &quot;Xcode -&gt; Targets -&gt; Info -&gt; Custom iOS Target Properties&rdquo;, add Key &ldquo;Privacy-Camera Usage Description&rdquo; with your description, like &ldquo;This App requires camera usage.&rdquo;</p>
<h3 id='2-add-package-dependency' class='heading'>2. Add package dependency</h3>

<p>In the &ldquo;Xcode -&gt; Files -&gt; Add Package Dependencies&rdquo;, add the AzureAIVisionCore.xcframework, AzureAIVisionFace.xcframework as mentioned in <a href="#set-up-the-environment">Set up the environment</a>.</p>
<h3 id='3-copy-the-required-files' class='heading'>3. Copy the required files</h3>

<p>Copy all the files under FaceAnalyzerSample/Core folder into your project.</p>
<h3 id='4-insert-livenessview-into-your-ui-logic' class='heading'>4. Insert LivenessView into your UI logic</h3>

<p>&ldquo;LivenessView&rdquo; is the view you should insert into your application to serve for the liveness detection.
   Here are more details about the LivenessView init parameters.</p>

<p>For more information on how to orchestrate the liveness flow by utilizing the Azure AI Vision Face service, visit: <a href="https://aka.ms/azure-ai-vision-face-liveness-tutorial">https://aka.ms/azure-ai-vision-face-liveness-tutorial</a>.</p>

<p>(1) sessionAuthorizationToken: String.</p>

<p>required parameter. Used to authorize the client and allow the client to establish the session connection to the server.</p>

<p>(2) withVerification: Boolean.</p>

<p>Optional parameter, default as false. This boolean indicates whether the liveness detection is with verification or not.</p>

<p>(3) referenceImage: UIImage?.</p>

<p>Optional parameter, default as nil. This refers to the reference image provided in client. You can also provide this in the App server when creating the session.</p>

<p>(4) completionHandler: @escaping (String, String)-&gt;Void.</p>

<p>Optional parameter, default as empty function. Used to handle the liveness detection results and also help on the UI switch possibly, as shown in the FaceAnalyzerSample/MainView.swift, the completionHandler is set as:</p>
<pre class="highlight plaintext"><code>   completionHandler: { resultMessage, resultId in
                        sessionData.resultMessage = resultMessage
                        sessionData.resultId = resultId
                        DispatchQueue.main.async {
                           withAnimation {
                                 pageSelection.current = .result
                           }
                        }
                     }
</code></pre>

<p>In this case, the liveness result is processed to be a string &ldquo;resultMessage&rdquo; and saved in the sample App&rsquo;s &ldquo;sessionData&rdquo; object. The &ldquo;resultId&rdquo; represents the client requestId for trace logs purpose. You can modify the &ldquo;completionHandler&rdquo; definition and functionality here to process the liveness result in your own way and may also utilize it to help for your UI logic.</p>

<p>(5) detailsHandler: @escaping (FaceAnalyzedDetails?)-&gt;Void.</p>

<p>Optional parameter, default as empty function. Used to handle the &ldquo;digest&rdquo;. You can get the &ldquo;digest&rdquo; like:</p>
<pre class="highlight plaintext"><code>   var digest = faceAnalyzedDetails?.digest
</code></pre>

<p>This &ldquo;digest&rdquo; is recommended to be used to validate the integrity of the transport.
   For more information, please refer to the later part: <a href="#7-add-validation-for-the-integrity-of-the-service-result">Add validation for the integrity of the service result</a>.</p>

<p>Create other views per your needs, like what we have in the sample App (MainView.swift, LaunchView.swift, etc) to start/end the process, and save the face analysis results for your usage.</p>
<h3 id='5-configure-the-liveness-algorithm-details-for-advanced-settings' class='heading'>5. Configure the liveness algorithm details for advanced settings</h3>

<p>With first 4 steps, you should be able to run liveness detection in your own project. Here are more advanced details for you to understand the API usage. The file LivenessActor.swift contains the method on how to create and initialize the &ldquo;FaceAnalyzer&rdquo;. Specifically,</p>

<p>(1) <strong><em>Configuring the FaceAPI service to obtain the required session-authorization-token</em></strong></p>
<pre class="highlight swift"><code>   <span class="c1">// this is for demo purpose only, session-authorization-token can be obtained in the App server directly</span>
   <span class="k">let</span> <span class="nv">sessionAuthorizationToken</span> <span class="o">=</span> <span class="nf">obtainToken</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
   <span class="n">serviceOptions</span> <span class="o">=</span> <span class="k">try</span>  <span class="kt">VisionServiceOptions</span><span class="p">(</span><span class="nv">endpoint</span><span class="p">:</span> <span class="s">""</span><span class="p">)</span>
   <span class="n">serviceOptions</span><span class="p">?</span><span class="o">.</span><span class="n">authorizationToken</span> <span class="o">=</span> <span class="n">sessionAuthorizationToken</span>
</code></pre>

<p>Note:</p>

<ul>
<li>A demo version on obtaining the token is in <code>AppUtility.swift</code> for the demo app to be built as an standalone solution, but this is not recommended.  The &ldquo;session-authorization-token&rdquo; is required to start a liveness session.  For more information on how to orchestrate the liveness flow by utilizing the Azure AI Vision Face service, visit: <a href="https://aka.ms/azure-ai-vision-face-liveness-tutorial">https://aka.ms/azure-ai-vision-face-liveness-tutorial</a>.</li>
</ul>

<p>(2) <strong><em>Configuring the face analyzer</em></strong></p>
<pre class="highlight swift"><code>   <span class="k">let</span> <span class="nv">createOptions</span> <span class="o">=</span> <span class="k">try!</span> <span class="kt">FaceAnalyzerCreateOptions</span><span class="p">()</span>
   <span class="n">createOptions</span><span class="o">.</span><span class="n">faceAnalyzerMode</span> <span class="o">=</span> <span class="kt">FaceAnalyzerMode</span><span class="o">.</span><span class="n">trackFacesAcrossImageStream</span>
</code></pre>

<p>(3)  <strong><em>Configuring the Analysis method</em></strong></p>
<pre class="highlight swift"><code>   <span class="k">let</span> <span class="nv">methodOptions</span> <span class="o">=</span> <span class="k">try!</span> <span class="kt">FaceAnalysisOptions</span><span class="p">()</span>
   <span class="n">methodOptions</span><span class="o">.</span><span class="n">faceSelectionMode</span> <span class="o">=</span> <span class="kt">FaceSelectionMode</span><span class="o">.</span><span class="n">largest</span>
</code></pre>

<p>(4)  <strong><em>Initializing the face analyzer</em></strong></p>
<pre class="highlight swift"><code>   <span class="n">faceAnalyzer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">await</span> <span class="kt">FaceAnalyzer</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="nv">serviceOptions</span><span class="p">:</span> <span class="n">serviceOptions</span><span class="p">,</span> <span class="nv">input</span><span class="p">:</span> <span class="n">visionSource</span><span class="p">,</span> <span class="nv">createOptions</span><span class="p">:</span> <span class="n">createOptions</span><span class="p">)</span>
</code></pre>

<p>(5)  <strong><em>Registering listeners for analyzer events and results</em></strong></p>
<pre class="highlight swift"><code>   <span class="n">faceAnalyzer</span><span class="p">?</span><span class="o">.</span><span class="n">addAnalyzingEventHandler</span><span class="p">{(</span><span class="nv">analyzer</span><span class="p">:</span> <span class="kt">FaceAnalyzer</span><span class="p">,</span> <span class="nv">result</span><span class="p">:</span> <span class="kt">FaceAnalyzingResult</span><span class="p">)</span> <span class="k">in</span>
       <span class="k">let</span> <span class="nv">faces</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">faces</span>
       <span class="k">let</span> <span class="nv">face</span> <span class="o">=</span> <span class="n">faces</span><span class="p">?[</span><span class="n">faces</span><span class="o">!.</span><span class="n">startIndex</span><span class="p">]</span>
       <span class="c1">// your analyzingEventHandler</span>
   <span class="p">}</span>

   <span class="n">faceAnalyzer</span><span class="p">?</span><span class="o">.</span><span class="n">addAnalyzedEventHandler</span> <span class="p">{[</span><span class="n">parameters</span><span class="p">]</span> <span class="p">(</span><span class="nv">analyzer</span><span class="p">:</span> <span class="kt">FaceAnalyzer</span><span class="p">,</span> <span class="nv">result</span><span class="p">:</span> <span class="kt">FaceAnalyzedResult</span><span class="p">)</span> <span class="k">in</span>
       <span class="k">let</span> <span class="nv">faces</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">faces</span>
       <span class="k">let</span> <span class="nv">face</span> <span class="o">=</span> <span class="n">faces</span><span class="p">?[</span><span class="n">faces</span><span class="o">!.</span><span class="n">startIndex</span><span class="p">]</span>
       <span class="c1">// your analyzedEventHandler</span>
   <span class="p">}</span>
</code></pre>

<p>(6)  <strong><em>Starting the analyzer</em></strong></p>
<pre class="highlight swift"><code>   <span class="n">faceAnalyzer</span><span class="p">?</span><span class="o">.</span><span class="nf">analyzeOnce</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="n">methodOptions</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
       <span class="c1">// your analyzeOnce completionHandler</span>
   <span class="p">})</span>
</code></pre>
<h3 id='6-add-required-localizations' class='heading'>6. Add required localizations</h3>

<p>All the on-screen prompt are defined with English as default language. We provide Chinese (simplified) as an example to add your localization.</p>

<p>(1) Go to &ldquo;Xcode -&gt; Targets -&gt; Info -&gt; Custom iOS Target Properties -&gt; Localizations&rdquo; to add all the languages you want to support.</p>

<p>(2) Refer to the Core/en.lproj and Core/zh-Hans.lproj to add the corresponding translation for all the added languages in your localizations.</p>
<h3 id='7-add-validation-for-the-integrity-of-the-service-result' class='heading'>7. Add validation for the integrity of the service result</h3>

<p>We highly recommend leveraging the &ldquo;digest&rdquo; generated within the solution to validate the integrity of the communication between your application and the Azure AI Vision Face service. This is necessary to ensure that the final liveness detection result is trustworthy. &ldquo;Digest&rdquo; is provided in the following two locations:</p>

<ol>
<li>The Face Analyzer running on your application.</li>
</ol>

<p>In the FaceAnalyzedDetails object.</p>

<ol>
<li>The Azure AI Vision Face service.</li>
</ol>

<p>The &ldquo;digest&rdquo; will be contained within the liveness detection result when calling the detectliveness/singlemodal/sessions/<session-id> REST call. Look for an example of the &ldquo;digest&rdquo; in the <a href="https://aka.ms/azure-ai-vision-face-liveness-tutorial">tutorial</a> where the liveness detection result is shown.</p>

<p>Digests must match between the application and the service. We recommend using these digests in conjunction with iOS integrity APIs to perform the final validation.
   For more information on the iOS Integrity APIs, please refer to:</p>

<ul>
<li><a href="https://developer.apple.com/documentation/devicecheck">DeviceCheck | Apple Developer Documentation</a></li>
</ul>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2024 <a class="link" href="" target="_blank" rel="external noopener"></a>. All rights reserved. (Last updated: 2024-05-03)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external noopener">jazzy ♪♫ v0.14.4</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external noopener">Realm</a> project.</p>
    </section>
  </body>
</html>
